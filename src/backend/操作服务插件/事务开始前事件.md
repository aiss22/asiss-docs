# BeforeExecuteOperationTransaction事务开始前事件

插件注册到：操作列表--选择操作--点击编辑--其他控制--服务插件--注册

说明：
通常将一些与数据更新无关的前期数据准备，放在本事件中进行，以减少事务占用时间。
操作执行前，事务开始前事件

1. 此事件在操作校验之后、操作实现代码之前执行

2. 此事件在操作事务之前，即此事件中的数据库处理，不受操作的事务保护

3. 通常此事件，也可以用来进行数据校验

添加引用程序集：using System.ComponentModel.Composition;

```示例
//继承操作服务插件
public class OnAddValidatorsHead:AbstractOperationServicePlugIn
{
    //定义一个DataTable字段
    DataTable dtTable;

    //OnPreparePropertys 数据加载前，确保需要的属性被加载
    public override void OnPreparePropertys(PreparePropertysEventArgs e)
    {
        base.OnPreparePropertys(e);
        //加载整数字段
        e.FieldKeys.Add("FHHID");
    }

    //事务开始前事件
    public override void BeforeExecuteOperationTransaction(BeforeExecuteOperationTransaction e)
    {
        base.BeforeExecuteOperationTransaction(e);

        e.CancelMessage = "测试终止操作执行";//弹窗
        e.Cancel = true;
    }
}
```

## 业务场景：采购订单，单据体字段FHHID如果已存在重复，保存的时候提示报错

```示例
//继承操作服务插件
public class OnAddValidatorsHead:AbstractOperationServicePlugIn
{
    //定义一个DataTable字段
    DataTable dtTable;

    //OnPreparePropertys 数据加载前，确保需要的属性被加载
    public override void OnPreparePropertys(PreparePropertysEventArgs e)
    {
        base.OnPreparePropertys(e);
        //加载整数字段
        e.FieldKeys.Add("FHHID");
    }

    //事务开始前事件
    public override void BeforeExecuteOperationTransaction(BeforeExecuteOperationTransaction e)
    {
        base.BeforeExecuteOperationTransaction(e);

        //所选择的行，循环，读取单据体POOrderEntry
        foreach(ExtendedDataEntity extended in e.SelectedRows)
        {
            int flog = 0;
            DynamicObject dy = extended.DataEntity;
            DynamicObjectCollection docPriceEntity = dy["POOrderEntry"] as DynamicObjectCollection;
            foreach(DynamicObject HHentity in docPriceEntity)
            {
                //如果FHHID已存在，报错
                if (Convert.ToString(HHentity["FHHID"])!="0")
                {
                    if(flog==0)
                    {
                        string sqlselect = "/*dialect*/select 1 cut from t_PUR_POOrderEntry "+
                            "where FENTRYID<>"+ HHentity["ID"] + "and FHHID=" + HHentity["FHHID"];
                        dtTable = DBUtils.ExecuteDataSet(this.Context, sqlselect).Tables[0];

                        if(dtTable.Rows.Count>0)
                        {
                            flog=1;
                        }
                    }
                       
                }
            }
            if(flog==1)
            {
                throw new KDBusinessException("","FHHID导入重复数据！");
            }
        }
    }
}
```
