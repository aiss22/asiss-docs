<<<<<<< HEAD
# 表单插件：保存操作后刷新字段

应用场景：保存操作，操作后刷新字段的设置，仅能刷新字段的界面状态，并不能刷新字段的数据

操作编号：1=新增, 2=修改, 6=提交, 7=审核, 8=保存, 9=反审核...

```1
    /// <summary>
    /// 【表单插件】保存操作后刷新字段
    /// </summary>
    [Description("【表单插件】保存操作后刷新字段"), HotUpdate]
    public class UpdateFieldAfterSaveFormPlugIn : AbstractDynamicFormPlugIn
    {
        public override void AfterDoOperation(AfterDoOperationEventArgs e)
        {
            base.AfterDoOperation(e);
            if (e.Operation.OperationId == 8)//金蝶每个操作都有编号：8号为保存
            {
                // 保存操作后刷新字段
                var loadKeys = new List<string>(new[] { "F_Jac_Combo" });
                ((IBillModel)this.Model).SynDataFromDB(loadKeys);//从数据库同步数据
            }
        }
    }
    //服务插件可以直接操作数据库，在后台运行
    /// <summary>
    /// 【服务插件】保存操作后刷新字段
    /// </summary>
    [Description("【服务插件】保存操作后刷新字段"), HotUpdate]
    public class UpdateFieldAfterSaveTestOperationServicePlugIn : AbstractOperationServicePlugIn
    {
        public override void AfterExecuteOperationTransaction(AfterExecuteOperationTransaction e)//任何操作（包括保存）在数据库事务提交成功后触发
        {
            base.AfterExecuteOperationTransaction(e);
            if (this.OperationResult.IsSuccess && e.DataEntitys != null && e.DataEntitys.Length > 0)//判断三件事：操作是否成功，保存的数据不为空，数据长度大于0
            {
                // 保存操作成功后，清空下拉字段的值
                var ids = string.Join(",", e.DataEntitys.Select(o => o[0]).ToArray());//把这次保存的单据内码（FID）全部取出，用逗号拼接成字符串
                var sql = string.Format("UPDATE T_PUR_POORDER SET F_Jac_Combo='' WHERE FID IN ({0})", ids);//把数据库表里刚保存单据的F_Jac_Combo字段列清空
                DBUtils.Execute(Context, sql);
            }
        }
    }
```
=======
# 表单插件：保存操作后刷新字段

应用场景：保存操作，操作后刷新字段的设置，仅能刷新字段的界面状态，并不能刷新字段的数据

操作编号：1=新增, 2=修改, 6=提交, 7=审核, 8=保存, 9=反审核...

```/// <summary>
    /// 【表单插件】保存操作后刷新字段
    /// </summary>
    [Description("【表单插件】保存操作后刷新字段"), HotUpdate]
    public class UpdateFieldAfterSaveFormPlugIn : AbstractDynamicFormPlugIn
    {
        public override void AfterDoOperation(AfterDoOperationEventArgs e)
        {
            base.AfterDoOperation(e);
            if (e.Operation.OperationId == 8)//金蝶每个操作都有编号：8号为保存
            {
                // 保存操作后刷新字段
                var loadKeys = new List<string>(new[] { "F_Jac_Combo" });
                ((IBillModel)this.Model).SynDataFromDB(loadKeys);//从数据库同步数据
            }
        }
    }
    //服务插件可以直接操作数据库，在后台运行
    /// <summary>
    /// 【服务插件】保存操作后刷新字段
    /// </summary>
    [Description("【服务插件】保存操作后刷新字段"), HotUpdate]
    public class UpdateFieldAfterSaveTestOperationServicePlugIn : AbstractOperationServicePlugIn
    {
        public override void AfterExecuteOperationTransaction(AfterExecuteOperationTransaction e)//任何操作（包括保存）在数据库事务提交成功后触发
        {
            base.AfterExecuteOperationTransaction(e);
            if (this.OperationResult.IsSuccess && e.DataEntitys != null && e.DataEntitys.Length > 0)//判断三件事：操作是否成功，保存的数据不为空，数据长度大于0
            {
                // 保存操作成功后，清空下拉字段的值
                var ids = string.Join(",", e.DataEntitys.Select(o => o[0]).ToArray());//把这次保存的单据内码（FID）全部取出，用逗号拼接成字符串
                var sql = string.Format("UPDATE T_PUR_POORDER SET F_Jac_Combo='' WHERE FID IN ({0})", ids);//把数据库表里刚保存单据的F_Jac_Combo字段列清空
                DBUtils.Execute(Context, sql);
            }
        }
    }
```
>>>>>>> 7743361759f96bacfd22c86fcea90a36fcdac05f
